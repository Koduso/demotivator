<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="styles.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@500&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">

	<title>Document</title>
</head>
<canvas id="canvas" style="display: block;">?</canvas>
<body style="overflow: hidden;" bgcolor="f5f5f5">
	<input class="input">
	<button class="add">
		Добавить текст
	</button> 
	<form enctype="multipart/form-data" method="post">
    <p><input type="file" name="f" class="image">
    <input type="submit" value="Отправить">
    <input type="button" class="download" value="Скачать"></p>


    <!--Как скачать canvas?-->
    
	<script> 

		let add = document.querySelector('.add')
		add.addEventListener("click", function(){
			ctx.fillStyle = "#2A2E3A";
			ctx.fillRect(0, 555, 600, 600)
			ctx.fillStyle = "white"
			ctx.fillText(input.value, 290, 589);
		})
    
        let download = document.querySelector('.download')
        let input = document.querySelector('.input')
		let canvas = document.getElementById('canvas')
		let ctx = canvas.getContext("2d")
        let image = document.querySelector('.image')

        download.addEventListener('click', function(){
			let link = document.createElement('a');
			link.download = 'filename.png';
			link.href = document.getElementById('canvas').toDataURL()
			link.click();
        }
        )

        image.addEventListener('input', function(event){
           const selectedfile = event.target.files;
           if (selectedfile.length > 0) {
	           const [imageFile] = selectedfile;
	           const fileReader = new FileReader();
	           fileReader.onload = () => {
		           const srcData = fileReader.result;
		           const img = new Image()
                   img.src = srcData;
                   img.onload = (function(){
                   	ctx.drawImage(img, 51, 51, 499, 499);
                   })  
	           };
	           fileReader.readAsDataURL(imageFile);

            }
        })

        

		canvas.width = 600;
		canvas.height = 600;
		ctx.fillStyle = "#2A2E3A";
		ctx.fillRect(0, 0, 600, 600);
		ctx.strokeStyle = "#fff";
        ctx.strokeRect(50,50,500,500);

        ctx.font = "30px Arial";
        ctx.fillStyle = "#fff";
        ctx.textAlign = "center";

        
	</script>
</body>
</html>